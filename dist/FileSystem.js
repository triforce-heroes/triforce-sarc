import{BufferBuilder as e}from"@triforce-heroes/triforce-core/BufferBuilder";import{hash as t}from"./utils/hash.js";export class FileSystem{constructor(e=new Map){this.entries=e}get(e){return this.entries.get(e)}set(e,t){this.entries.set(e,t)}delete(e){this.entries.delete(e)}build(n=0){let i=new e(n);i.writeString("SFAT"),i.writeUnsignedInt16(12),i.writeUnsignedInt16(this.entries.size),i.writeUnsignedInt32(101);let r=new e(n),s=new e(n),g=new e(n);for(let[e,n]of(s.writeString("SFNT"),s.writeUnsignedInt16(8),s.writeUnsignedInt16(0),[...this.entries.entries()].sort((e,n)=>t(e[0],101)-t(n[0],101)))){r.writeUnsignedInt32(t(e,101)),r.writeUnsignedInt32((s.length-8)/4+16777216),r.writeUnsignedInt32(g.length),r.writeUnsignedInt32(g.length+n.length),g.push(n),g.pad(16);let i=Buffer.from(`${e}\0`);s.push(i),s.pad(4)}s.pad(16);let d=20+i.length+r.length+s.length,l=new e(n);return l.writeString("SARC"),l.writeUnsignedInt16(20),l.writeUnsignedInt16(65279),l.writeUnsignedInt32(d+g.length),l.writeUnsignedInt32(d),l.writeUnsignedInt16(256),l.writeUnsignedInt16(0),l.push(i.build(),r.build(),s.build(),g.build()),l.build()}}