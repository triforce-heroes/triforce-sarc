import{existsSync as e,readFileSync as o,writeFileSync as t,readdirSync as r}from"node:fs";import{join as i,relative as s}from"node:path";import{fatal as f,normalize as n}from"@triforce-heroes/triforce-core";import{extract as m}from"../Extract.js";import{FileSystem as a}from"../FileSystem.js";export function RebuildCommand(c,d,l){e(c)||f(`Directory not found: ${c}`);let p=n(d??`${c}.sarc`);process.stdout.write(`Rebuild ${n(c)} to ${p}... `);let u=new a;if(l?.base!==void 0)for(let t of(e(l.base)||f(`Base file not found: ${l.base}`),m(o(l.base))))u.set(t.name,t.data);!function e(t,f,m){for(let a of r(f,{withFileTypes:!0})){let r=n(i(f,a.name));if(a.isDirectory()){e(t,r,m);continue}m.set(n(s(t,r)),o(r))}}(n(c),n(c),u),t(p,u.build()),process.stdout.write("OK\n")}