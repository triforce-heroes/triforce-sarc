import{existsSync as o,readFileSync as e,writeFileSync as t,readdirSync as r}from"node:fs";import{join as i,relative as s}from"node:path";import{fatal as f}from"@triforce-heroes/triforce-core/Console";import{normalize as n}from"@triforce-heroes/triforce-core/Path";import{extract as m}from"../Extract.js";import{FileSystem as c}from"../FileSystem.js";export function RebuildCommand(a,d,l){o(a)||f(`Directory not found: ${a}`);let p=n(d??`${a}.sarc`);process.stdout.write(`Rebuild ${n(a)} to ${p}... `);let u=new c;if(l?.base!==void 0)for(let t of(o(l.base)||f(`Base file not found: ${l.base}`),m(e(l.base))))u.set(t.name,t.data);!function o(t,f,m){for(let c of r(f,{withFileTypes:!0})){let r=n(i(f,c.name));if(c.isDirectory()){o(t,r,m);continue}m.set(n(s(t,r)),e(r))}}(n(a),n(a),u),t(p,u.build()),process.stdout.write("OK\n")}